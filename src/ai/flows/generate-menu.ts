
// This is an autogenerated file from Firebase Studio.
'use server';
/**
 * @fileOverview Generates a Chilean menu with suggested and optional lunches for a specified number of days,
 * including Peruvian and Latin American dishes popular in Chile.
 *
 * - generateMenu - A function that generates the menu.
 * - GenerateMenuInput - The input type for the generateMenu function.
 * - GenerateMenuOutput - The return type for the generateMenu function.
 */

import {ai} from '@/ai/genkit';
import {z} from 'genkit';

const GenerateMenuInputSchema = z.object({
  numberOfDays: z
    .number()
    .describe('El número de días para los cuales generar el menú.')
    .min(1),
});
export type GenerateMenuInput = z.infer<typeof GenerateMenuInputSchema>;

const CoreRecipeSchema = z.object({
  recipeName: z.string().describe('Nombre de la receta.'),
  ingredients: z.array(z.string()).describe('Lista de ingredientes para la receta.'),
  instructions: z.string().describe('Instrucciones para preparar la receta.'),
  evocativeDescription: z.string().describe('Un texto corto, poético/evocador para incitar a cocinar el plato.'),
  imageDataUri: z.string().optional().describe('URI de datos de la imagen generada para el plato (opcional).'),
});
export type CoreRecipe = z.infer<typeof CoreRecipeSchema>;

const DailyMenuSchema = z.object({
  day: z.number().describe('El número del día en el menú.'),
  suggestedLunch: CoreRecipeSchema.describe('El almuerzo sugerido para este día.'),
  optionalLunch: CoreRecipeSchema.describe('El almuerzo opcional para este día.'),
});
export type DailyMenu = z.infer<typeof DailyMenuSchema>;

const GenerateMenuOutputSchema = z.object({
  menu: z.array(DailyMenuSchema).describe('El menú generado con almuerzos sugeridos y opcionales para cada día.'),
});
export type GenerateMenuOutput = z.infer<typeof GenerateMenuOutputSchema>;

export async function generateMenu(input: GenerateMenuInput): Promise<GenerateMenuOutput> {
  return generateMenuFlow(input);
}

const prompt = ai.definePrompt({
  name: 'generateMenuPrompt',
  input: {schema: GenerateMenuInputSchema},
  output: {schema: GenerateMenuOutputSchema},
  prompt: `Eres un chef experto en crear menús balanceados y deliciosos, con conocimiento de gastronomía chilena, peruana y latinoamericana popular en Chile.

Generarás un menú para {{numberOfDays}} días. Para cada día, debes proponer dos opciones de almuerzo: un "almuerzo sugerido" y un "almuerzo opcional". Todas las recetas deben ser adecuadas para 4 personas y deben incluir una mezcla de platos típicos chilenos, así como opciones básicas de comida peruana y latinoamericana que sean comunes y apreciadas en Chile (por ejemplo, Lomo Saltado, Ají de Gallina, Ceviche simple, Sopa de Mariscos, etc.).

Para cada receta (tanto sugerida como opcional), incluye:
- recipeName: Nombre de la receta.
- ingredients: Lista de ingredientes.
- instructions: Instrucciones detalladas de preparación.
- evocativeDescription: Un texto corto (1-2 frases), inspirador y "semi-poético" que invite a preparar y disfrutar el plato. Ejemplo: "Un clásico reconfortante que abraza el alma con cada bocado." o "Sabores vibrantes que te transportarán a una tarde soleada junto al mar."

No incluyas desayunos ni cenas, solo las dos opciones de almuerzo por día.
No incluyas el campo imageDataUri en tu respuesta JSON, se generará por separado.

Devuelve el menú en formato JSON.

Ejemplo de cómo debería ser la estructura para un día:
{
  "day": 1,
  "suggestedLunch": {
    "recipeName": "Pastel de Choclo",
    "ingredients": ["Carne Molida", "Pollo", "Cebolla", "Choclo", "Leche", "Albahaca", "Huevo Duro", "Aceitunas"],
    "instructions": "Preparar un pino con carne molida, pollo y cebolla. Aparte, moler choclo con leche y albahaca. En una fuente para horno, colocar el pino, huevo duro y aceitunas. Cubrir con la mezcla de choclo. Hornear hasta dorar.",
    "evocativeDescription": "Un abrazo de la tierra chilena, donde el dulzor del choclo se encuentra con el sabor profundo del pino."
  },
  "optionalLunch": {
    "recipeName": "Lentejas con Arroz",
    "ingredients": ["Lentejas", "Arroz", "Cebolla", "Zanahoria", "Zapallo", "Longaniza (opcional)"],
    "instructions": "Remojar las lentejas. Cocinarlas con cebolla, zanahoria y zapallo picados. Agregar longaniza si se desea. Servir con arroz graneado.",
    "evocativeDescription": "Un plato humilde y poderoso, perfecto para recargar energías con el sabor de casa."
  }
}

Asegúrate de que la salida sea solo el objeto JSON que se ajusta al esquema de salida.
`,
});

const generateMenuFlow = ai.defineFlow(
  {
    name: 'generateMenuFlow',
    inputSchema: GenerateMenuInputSchema,
    outputSchema: GenerateMenuOutputSchema,
  },
  async input => {
    const {output} = await prompt(input);
    return output!;
  }
);

